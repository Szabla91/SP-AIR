<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Kalkulator Składowania AIR</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fff;
      color: #222;
      margin: 0;
      padding: 0;
    }
    .btn-back {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 8px 16px;
      background-color: #be1e2d;
      color: white;
      font-weight: 600;
      border-radius: 6px;
      text-decoration: none;
      transition: background-color 0.3s ease;
      z-index: 1000;
      border: none;
    }
    .btn-back:hover { background-color: #a31520; }

    .page-content {
      padding: 40px;
      max-width: 1000px;
      margin: 0 auto;
    }
    h1 {
      color: #be1e2d;
      border-bottom: 2px solid #be1e2d;
      padding-bottom: 10px;
      margin-bottom: 30px;
      font-size: 2.3rem;
      text-align: center;
      font-weight: 700;
    }

    .section {
      background-color: #fafbfc;
      margin-bottom: 30px;
      border: 1.5px solid #e5e5e5;
      padding: 28px 24px;
      border-radius: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }

    /* Etykiety i pola wewnątrz .section */
    .section label {
      display: block;
      margin-top: 10px;      /* mniejszy odstęp nad */
      margin-bottom: 2px;    /* minimalny odstęp pod */
      font-weight: 500;
      color: #222;
      text-align: left;
    }
    .section select,
    .section input[type="date"],
.section input[type="time"],
    .section input[type="number"] {
      display: block;
      padding: 7px 12px;
      border: 1.5px solid #ccc;
      border-radius: 7px;
      width: 100%;
      max-width: 250px;
      margin-top: 2px;       /* bardzo mały odstęp pod label */
      margin-left: 0;
      font-size: 1rem;
      box-sizing: border-box;
      font-family: inherit;
      text-align: left;
    }

    /* Sekcja rodzaju przesyłki – jeszcze ciaśniej */
    #shipment-type-container label {
      margin-top: 6px !important;
      margin-bottom: 2px;
    }
    #shipment-type-container select {
      margin-top: 2px !important;
    }
    /* Startowo kontener ukryty (JS go pokaże) */
    #shipment-type-container { display: none; }

    button {
      margin-top: 25px;
      padding: 12px 28px;
      background-color: #be1e2d;
      color: white;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1.04rem;
      transition: background-color 0.22s;
      letter-spacing: 0.03em;
    }
    button:hover { background-color: #a31520; }

    #result_storage {
      margin-top: 26px;
      border-top: 1px solid #ddd;
      padding-top: 18px;
      color: #222;
      font-size: 1.06rem;
    }

    @media (max-width: 700px) {
      .page-content { padding: 15px; }
      .section { padding: 16px 5px; }
    }
  </style>
</head>
<body>

<a href="https://bbats.sharepoint.com/:u:/r/sites/MLK/SitePages/AIR.aspx?csf=1&web=1&e=S9j1n1" class="btn-back">Powrót do ekranu głównego</a>

<div class="page-content">
  <h1>Kalkulator Składowania AIR</h1>

  <div class="section">
    <!-- Agent handlingowy -->
    <label for="agent">Wybierz agenta handlingowego:</label>
    <select id="agent">
      <option value="">Wybierz agenta</option>
      <option value="WAW LS">WAW LS</option>
      <option value="WAW WELCOME">WAW WELCOME</option>
      <option value="WAW SILVER">WAW SILVER</option>
      <option value="KTW LS">KTW LS</option>
      <option value="KTW SILVER">KTW SILVER</option>
      <option value="LCJ WELCOME">LCJ WELCOME</option>
      <option value="KRK WELCOME">KRK WELCOME</option>
      <option value="GDN WELCOME">GDN WELCOME</option>
      <option value="POZ WELCOME">POZ WELCOME</option>
      <option value="WRO WROLOT">WRO WROLOT</option>
    </select>

    <!-- Rodzaj przesyłki (pokazywany po wyborze agenta ≠ UCS) -->
    <div id="shipment-type-container">
      <label for="shipment_type">Wybierz rodzaj przesyłki:</label>
      <select id="shipment_type">
        <option value="General Cargo">General Cargo</option>
        <option value="DGR">DGR</option>
        <option value="PER">PER</option>
      </select>
    </div>


    <label for="wm" style="margin-top:10px;">Waga przesyłki:</label>
    <input type="number" id="wm" min="0" step="0.01" placeholder="np. 1.00" />


    <label for="unload_date">Data i godzina przyjęcia towaru na terminalu:</label>
    <input type="date" id="unload_date" /> <input type="time" id="unload_time" />

    <label for="pickup_date">Data i godzina odbioru towaru z magazynu:</label>
    <input type="date" id="pickup_date" /> <input type="time" id="pickup_time" />


    <button type="button" onclick="calculateRailStorage()">Oblicz koszty składowania</button>
    <div id="result_storage"></div>
  </div>
</div>

<script>
/* ====== CENNIK ====== */
const pricing = {
  "WAW LS": {
    "General Cargo": { mode: "days", freeDays: 3, arrivalExcluded: true, dailyRate: 0.54, minCost: 94,  currency: "PLN" },
    "DGR":           { mode: "days", freeDays: 2, arrivalExcluded: true, dailyRate: 1.07, minCost: 134, currency: "PLN" },
    "PER":           { mode: "days", freeDays: 1, arrivalExcluded: true, dailyRate: 1.07, minCost: 134, currency: "PLN" }
  },
  "WAW WELCOME": {
    "General Cargo": { mode: "days",   freeDays: 3,  arrivalExcluded: true, dailyRate: 0.48, minCost: 150, currency: "PLN" },
    "DGR":           { mode: "hours",  freeHours: 24,                 dailyRate: 1.07, minCost: 250, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours",  freeHours: 24,                 dailyRate: 1.29, minCost: 250, currency: "PLN", ceilDays: true }
  },
  "WAW SILVER": {
    "General Cargo": { mode: "hours", freeHours: 72, dailyRate: 0.50, minCost: 100, currency: "PLN", ceilDays: true },
    "DGR":           { mode: "hours", freeHours: 72, dailyRate: 0.80, minCost: 160, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours", freeHours: 72, dailyRate: 0.90, minCost: 160, currency: "PLN", ceilDays: true }
  },
  "KTW LS": {
    "General Cargo": { mode: "days", freeDays: 3, arrivalExcluded: false, dailyRate: 0.44, minCost: 77,  currency: "PLN" },
    "DGR":           { mode: "days", freeDays: 2, arrivalExcluded: true,  dailyRate: 0.77, minCost: 120, currency: "PLN" },
    "PER":           { mode: "days", freeDays: 1, arrivalExcluded: true,  dailyRate: 0.77, minCost: 140, currency: "PLN" }
  },
  "KTW SILVER": {
    "General Cargo": { mode: "hours", freeHours: 72, dailyRate: 0.40, minCost: 80,  currency: "PLN", ceilDays: true },
    "DGR":           { mode: "hours", freeHours: 72, dailyRate: 0.70, minCost: 140, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours", freeHours: 72, dailyRate: 0.80, minCost: 160, currency: "PLN", ceilDays: true }
  },
  "LCJ WELCOME": {
    "General Cargo": { mode: "days",  freeDays: 3, arrivalExcluded: true, dailyRate: 0.43, minCost: 100, currency: "PLN" },
    "DGR":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true }
  },
  "KRK WELCOME": {
    "General Cargo": { mode: "days",  freeDays: 3, arrivalExcluded: true, dailyRate: 0.43, minCost: 100, currency: "PLN" },
    "DGR":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true }
  },
  "GDN WELCOME": {
    "General Cargo": { mode: "days",  freeDays: 3, arrivalExcluded: true, dailyRate: 0.43, minCost: 100, currency: "PLN" },
    "DGR":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true }
  },
  "POZ WELCOME": {
    "General Cargo": { mode: "days",  freeDays: 3, arrivalExcluded: true, dailyRate: 0.43, minCost: 100, currency: "PLN" },
    "DGR":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true }
  },
  "WRO WROLOT": {
    "General Cargo": { mode: "days",  freeDays: 3, arrivalExcluded: true, dailyRate: 0.43, minCost: 100, currency: "PLN" },
    "DGR":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true },
    "PER":           { mode: "hours", freeHours: 24,                 dailyRate: 1.07, minCost: 200, currency: "PLN", ceilDays: true }
  }
};

/* ====== POMOCNICZE ====== */
const DAY_MS = 24 * 60 * 60 * 1000;

function parseDateTime(dateInputId, timeInputId) {
  const d = document.getElementById(dateInputId).value;
  const t = document.getElementById(timeInputId).value || "00:00";
  return new Date(`${d}T${t}:00`);
}

function endOfDay(dateObj) {
  const d = new Date(dateObj);
  d.setHours(23, 59, 59, 999);
  return d;
}

function startOfNextDay(dateObj) {
  const d = new Date(dateObj);
  d.setHours(0, 0, 0, 0);
  d.setDate(d.getDate() + 1);
  return d;
}

/* ====== GŁÓWNA FUNKCJA LICZENIA ====== */
function calculateRailStorage() {
  const agent = document.getElementById('agent').value;
  const shipmentType = document.getElementById('shipment_type').value;
  const weight = parseFloat(document.getElementById('wm').value);
  const start = parseDateTime('unload_date', 'unload_time');   // ARRIVAL (data+godzina)
  const end   = parseDateTime('pickup_date', 'pickup_time');   // PICKUP  (data+godzina)

  const resultBox = document.getElementById('result_storage');
  resultBox.innerHTML = '';

  // walidacje
  let errs = [];
  if (!agent) errs.push('Wybierz agenta handlingowego.');
  if (!shipmentType) errs.push('Wybierz rodzaj przesyłki.');
  if (!weight || weight <= 0) errs.push('Podaj wagę przesyłki większą od zera.');
  if (isNaN(start.getTime()) || isNaN(end.getTime())) errs.push('Wprowadź poprawne daty i godziny.');
  if (start && end && end < start) errs.push('Data/godzina odbioru nie może być wcześniejsza niż przyjęcia.');
  if (errs.length) {
    resultBox.innerHTML = `<p style="color:red">${errs.join('<br>')}</p>`;
    return;
  }

  const policy = pricing[agent]?.[shipmentType];
  if (!policy) {
    resultBox.innerHTML = `<p style="color:red">Brak cennika dla wybranego agenta i typu przesyłki.</p>`;
    return;
  }

  let chargeDays = 0;
  let freeInfo = '';
  let detailLine = ''; // różne linie dla trybu „dni” vs „godzin”
  let exceededLabel = ''; // „Przekroczone dni”/„Przekroczone godziny”
  let exceededValue = 0;

  if (policy.mode === 'days') {
    // Okno darmowe wg dni, z opcją pominięcia dnia przylotu
    const freeStart = policy.arrivalExcluded ? startOfNextDay(start) : new Date(start);
    const freeEnd = endOfDay(new Date(freeStart.getTime() + (policy.freeDays - 1) * DAY_MS));
    freeInfo = `${policy.freeDays} ${policy.arrivalExcluded ? 'dni (nie licząc dnia przylotu)' : ''} (${freeStart.toLocaleDateString('pl-PL')} – ${freeEnd.toLocaleDateString('pl-PL')})`;

    if (end > freeEnd) {
      const diffMs = end - freeEnd;
      const fullDays = Math.ceil(diffMs / DAY_MS);
      chargeDays = Math.max(0, fullDays);
      exceededLabel = 'Przekroczone dni';
      exceededValue = chargeDays;
    } else {
      chargeDays = 0;
      exceededLabel = 'Przekroczone dni';
      exceededValue = 0;
    }

    detailLine = `<p><strong>${exceededLabel}:</strong> ${exceededValue}</p>`;
  } else if (policy.mode === 'hours') {
    // Okno darmowe wg godzin (WELCOME DGR/PER – 24h, SILVER – 72h).
    const freeUntil = new Date(start.getTime() + policy.freeHours * 60 * 60 * 1000);
    freeInfo = `${policy.freeHours}h (od ${start.toLocaleString('pl-PL')} do ${freeUntil.toLocaleString('pl-PL')})`;

    const exceededMs = Math.max(0, end - freeUntil);
    const exceededHours = exceededMs / (60 * 60 * 1000);
    exceededLabel = 'Przekroczone godziny';
    exceededValue = exceededHours;

    // Naliczanie dób dziennych:
    // - SILVER i wszystkie tryby „hours” -> zaokrąglenie w górę (ceilDays: true)
    // - (gdyby był wariant proporcjonalny – zamiast ceil można by użyć Math.floor/Math.round)
    const baseDays = exceededHours / 24;
    chargeDays = exceededHours > 0 ? (policy.ceilDays ? Math.ceil(baseDays) : Math.floor(baseDays)) : 0;

    detailLine = `<p><strong>${exceededLabel}:</strong> ${exceededHours.toFixed(1)} h ${exceededHours > 0 ? `(naliczone doby: ${chargeDays})` : ''}</p>`;
  }

  // Koszt
  let totalCost = chargeDays * policy.dailyRate * weight;
  if (chargeDays > 0 && totalCost < policy.minCost) totalCost = policy.minCost;

  // Prezentacja
  resultBox.innerHTML = `
    <p><strong>Okres składowania:</strong> ${start.toLocaleString('pl-PL')} – ${end.toLocaleString('pl-PL')}</p>
    <p><strong>Okres wolny od opłat: </strong> ${freeInfo}</p>
    ${detailLine}
    <p><strong>Stawka dzienna:</strong> ${policy.dailyRate} ${policy.currency} / KG / dzień</p>
    <p><strong>Minimalna stawka:</strong> ${policy.minCost} ${policy.currency}</p>
    <p><strong><b>Łączny koszt:</b> <span style="color:#be1e2d;">${totalCost.toFixed(2)} ${policy.currency}</span></b></p>
  `;
}

/* ====== UI: POKAŻ/UKRYJ WYBÓR TYPU ====== */
function handleAgentChange() {
  const agent = document.getElementById('agent').value;
  const box = document.getElementById('shipment-type-container');
  const st  = document.getElementById('shipment_type');
  if (agent) {
    box.style.display = 'block';   // zawsze pokazuj po wyborze agenta
    if (!st.value) st.value = 'General Cargo';
  } else {
    box.style.display = 'none';
    st.value = '';
  }
}

/* ====== DOMYŚLNA DATA+GODZINA ====== */
function setDefaultDateTime() {
  const today = new Date();
  const dStr = today.toISOString().split('T')[0];
  const hh = String(today.getHours()).padStart(2, '0');
  const mm = String(today.getMinutes()).padStart(2, '0');

  const unloadDate = document.getElementById('unload_date');
  const unloadTime = document.getElementById('unload_time');
  const pickupDate = document.getElementById('pickup_date');
  const pickupTime = document.getElementById('pickup_time');

  if (unloadDate && !unloadDate.value) unloadDate.value = dStr;
  if (pickupDate && !pickupDate.value) pickupDate.value = dStr;
  if (unloadTime && !unloadTime.value) unloadTime.value = `${hh}:${mm}`;
  if (pickupTime && !pickupTime.value) pickupTime.value = `${hh}:${mm}`;
}

/* ====== LISTENERY ====== */
document.getElementById('agent').addEventListener('change', handleAgentChange);
document.addEventListener('DOMContentLoaded', () => {
  setDefaultDateTime();
  handleAgentChange(); // ustaw widoczność „rodzaju przesyłki” na starcie
});
</script>


</body>
</html>
